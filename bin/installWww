#!/bin/bash

# Install new code from a tarball.
source $HEXCALC/ops/config.sh

if [ -z $INSTALL_TAR_PATH ]; then
    echo "Exited, the env var, INSTALL_TAR_PATH, must be defined"
    echo "Do you want to run deployWww instead?"
    exit 1
fi

FILE=compute.tgz
LOCALTAR=$HEXCALC/ops/$FILE
FROMTAR=$INSTALL_TAR_PATH/$FILE
echo "scp'g from $FROMTAR to $LOCALTAR..."
scp $FROMTAR $LOCALTAR

echo "removing old code..."
rm -r -f \
    $HEXCALC/bin \
    $HEXCALC/build \
    $HEXCALC/calc \
    $HEXCALC/ops/configExamples \
    $HEXCALC/standalone \
    $HEXCALC/tests \
    $HEXCALC/www \
    >/dev/null 2>&1

echo "untarring..."
tar -xf $LOCALTAR -C $HEXCALC
#tar -xf $INSTALL_TAR_PATH -C $HEXCALC

#PROTECTED_PORT=false
if [ "$PORT" = "443" ] || [ "$PORT" = "80" ]; then
    echo "Untar complete. Issue 'sudo startAsRoot' to (re)start server"
else
    echo "Untar complete. Issue 'start' to (re)start server"
fi

